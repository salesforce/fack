<% content_for :title, "Chrome Extension Token" %>

<div class="flex items-center justify-center py-12 px-4">
  <div class="bg-white p-10 rounded-xl shadow-lg text-center max-w-lg w-full">
    <div class="text-5xl text-green-500 mb-5">âœ“</div>
    <h1 class="text-gray-800 mb-5 text-2xl font-semibold">Authentication Successful</h1>
    
    <p class="mb-5">Your user email for the Chrome extension:</p>
    
    <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-5 my-5 break-all font-mono text-sm min-h-15 flex items-center justify-center">
      <div id="token-display" data-token="<%= current_user&.email %>" class="text-sky-600 font-semibold">
        <%= current_user&.email || 'No email available. Please try again.' %>
      </div>
    </div>
    
    <div class="text-gray-600 text-sm leading-relaxed mt-5">
      <strong>Instructions:</strong><br>
      Your email above will be automatically captured by your Chrome extension.<br>
      You can safely close this window after the email is captured.
    </div>
    <!-- Debug info (remove in production) -->
    <div class="bg-gray-100 border border-gray-300 rounded p-3 mt-3 text-xs text-gray-600">
      <strong>Debug:</strong> User: <%= current_user&.email || 'NOT AUTHENTICATED' %> | 
      Session: <%= session[:user_id] || 'NO SESSION' %>
    </div>
  </div>
</div>

<script>
  console.log('Auth page loaded - email should be captured by Chrome extension content script');
  console.log('Email in data-token:', document.getElementById('token-display')?.getAttribute('data-token'));
  
  // Auto-close window after extension captures token
  setTimeout(() => {
    console.log('Auto-closing window...');
    if (window.opener || window.parent !== window) {
      try {
        window.close();
      } catch (e) {
        console.log('Could not close window automatically');
      }
    }
  }, 5000); // Reduced to 5 seconds
</script>
