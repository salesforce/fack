<div id="<%= dom_id(comment) %>" class="my-5 flex <%= current_user == comment.user ? 'justify-start' : 'justify-end' %>">
  <div class="w-3/4">
    <!-- Name and date outside the bubble -->
    <div class="flex justify-between items-center mb-1">
      <p class="text-xs text-gray-500 <%= current_user != comment.user ? 'text-right' : '' %>">
        <span class="font-semibold"><%= comment.user.email %></span>
        | <%= comment.created_at.strftime("%B %d, %Y at %I:%M %p") %>
        <% if comment.updated_at != comment.created_at %>
          (edited <%= time_ago_in_words(comment.updated_at) %> ago)
        <% end %>
      </p>
      <% if current_user && (current_user == comment.user || current_user.admin?) %>
        <div class="flex space-x-2">
          <button onclick="toggleEditComment('<%= dom_id(comment) %>')" class="text-xs text-sky-600 hover:text-sky-800">
            Edit
          </button>
          <%= link_to "Delete", document_comment_path(@document, comment), 
              data: { 
                turbo_method: :delete,
                turbo_confirm: "Are you sure you want to delete this comment?" 
              },
              class: "text-xs text-red-600 hover:text-red-800" %>
        </div>
      <% end %>
    </div>
    
    <!-- Comment bubble -->
    <div class="comment-content">
      <div class="p-4 rounded-bl-2xl rounded-br-2xl <%= current_user == comment.user ? 'rounded-tr-2xl' : 'rounded-tl-2xl' %> <%= current_user == comment.user ? 'bg-gray-100 text-stone-800' : 'bg-sky-100 text-sky-800' %> border <%= current_user == comment.user ? 'border-stone-200' : 'border-sky-300' %> shadow-sm">
        <p class="leading-relaxed"><%= simple_format(comment.content) %></p>
      </div>
    </div>
    
    <!-- Edit form -->
    <% if current_user && (current_user == comment.user || current_user.admin?) %>
      <div class="comment-edit-form hidden mt-3">
        <div class="p-4 rounded-bl-2xl rounded-br-2xl <%= current_user == comment.user ? 'rounded-tr-2xl' : 'rounded-tl-2xl' %> bg-gray-50 border border-gray-200 shadow-sm">
          <%= form_with model: [@document, comment], local: true, class: "space-y-3" do |form| %>
            <%= form.text_area :content, rows: 3, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent resize-vertical" %>
            <div class="flex space-x-2">
              <%= form.submit "Update Comment", class: "px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500" %>
              <button type="button" onclick="toggleEditComment('<%= dom_id(comment) %>')" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500">
                Cancel
              </button>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
