<div id="<%= dom_id document %>">
  <div class="border rounded-lg">
    <div class="text-xs rounded-t-lg text-stone-900">
      <h1 class="text-3xl font-light p-4 rounded-t bg-sky-800 text-sky-200"><%= document.title %></h1>
      <div class="flex justify-between items-center p-3">
        <div class="w-1/3">
          <% if document.url %>
            <p class="text-xs">Source <%= link_to document.url, document.url, class:"text-sky-500",target:"_source" %></p>
          <% end %>
          <p class="text-xs ">Stored in <%= link_to document.library.name, document.library, class:"text-sky-500" if document.library_id %> library</p>
          <p class=" text-xs text-stone-400">Created <%= time_ago_in_words(document.created_at) %> ago | Updated <%= time_ago_in_words(document.updated_at) %> ago</p>
        </div>
        <div class="w-1/8 justify-right">
          <%= button_to document_path(@document, toggle_disabled: true),
                method: :patch,
                data: { turbo_frame: dom_id(@document) },
                class: (@document.disabled ? 'bg-green-700' : 'bg-stone-700')  + " block text-white p-2 rounded-lg my-2" do %>
            <%= @document.disabled ? 'Enable' : 'Disable' %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="px-3 py-5 text-stone-800 bg-stone-100">
      <%= render_markdown(document.document.gsub(/^\s*\n/, '')) %>
    </div>
    <div class="text-xs p-3 text-stone-500 border border-stone-100 rounded-b-lg">
      <p class="text-stone-400">Info for nerds:</p>
      <p class=""><%= document.token_count %> Tokens | <%= document.embedding.present? ? "Embedding Ready" : "Embedding Missing"%>  | External id <%= document.external_id.present? ? document.external_id : " not provided"%></p>
      <p class=""></p>
    </div>
  </div>
  <% if session[:debug] == "true" then %>
    <h1 class="text-3xl font-light py-4 text-stone-500">Embedding</h1>
    <div class="markdown-content leading-5">
      <div class="whitespace-pre-wrap break-words font-mono p-5 border border-sky-600 rounded-lg bg-stone-200">
        <%= document.embedding unless document.embedding.nil? %>
      </div>
    </div>
  <% end %>
</div>
